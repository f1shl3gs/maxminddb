use std::fs::File;
use std::net::IpAddr;

const IP_LIST: [&str; 100] = [
    "16.55.182.141",
    "232.104.188.159",
    "178.230.108.208",
    "74.124.98.202",
    "140.133.27.250",
    "93.115.26.62",
    "42.151.215.252",
    "70.26.83.239",
    "180.232.54.157",
    "8.145.123.173",
    "117.143.105.65",
    "251.10.241.182",
    "29.136.217.17",
    "170.114.72.169",
    "210.16.236.229",
    "81.86.160.160",
    "137.202.155.11",
    "121.2.217.43",
    "236.23.2.126",
    "66.225.106.96",
    "120.99.197.154",
    "187.175.60.148",
    "29.192.238.194",
    "81.99.184.234",
    "179.34.97.124",
    "44.236.142.219",
    "104.181.14.1",
    "223.93.244.33",
    "38.40.60.59",
    "13.79.24.111",
    "62.236.30.116",
    "55.189.207.190",
    "100.51.185.2",
    "217.51.165.152",
    "88.55.98.222",
    "247.187.101.138",
    "119.125.208.51",
    "147.14.180.162",
    "228.230.201.6",
    "175.241.146.40",
    "196.65.162.207",
    "68.163.199.239",
    "61.47.119.100",
    "156.196.198.171",
    "44.77.70.201",
    "211.88.236.201",
    "25.182.216.198",
    "164.209.155.117",
    "77.76.173.60",
    "208.187.138.58",
    "136.33.5.60",
    "106.162.9.121",
    "207.62.243.145",
    "20.165.99.57",
    "253.235.177.124",
    "64.94.205.245",
    "200.131.203.136",
    "122.246.106.5",
    "192.172.118.94",
    "224.181.35.219",
    "40.168.99.227",
    "183.243.48.79",
    "235.95.113.224",
    "109.201.214.189",
    "65.105.238.63",
    "129.159.218.226",
    "203.139.182.99",
    "157.156.252.62",
    "171.54.161.46",
    "75.230.253.174",
    "193.33.243.1",
    "21.46.188.176",
    "213.21.117.10",
    "128.120.218.236",
    "178.244.95.23",
    "103.251.64.5",
    "135.31.26.108",
    "90.126.190.135",
    "239.23.89.250",
    "30.246.59.161",
    "1.86.182.210",
    "188.227.120.98",
    "85.50.235.4",
    "237.72.173.134",
    "159.223.220.95",
    "80.239.210.234",
    "161.214.17.150",
    "45.63.139.104",
    "229.55.68.216",
    "16.92.125.101",
    "56.207.139.144",
    "170.31.108.104",
    "244.165.233.2",
    "14.51.213.245",
    "25.93.208.42",
    "116.110.148.175",
    "94.225.170.165",
    "123.176.228.183",
    "120.186.239.247",
    "113.175.185.37",
];

fn main() {
    let path = "GeoLite2-City.mmdb";
    let ips = IP_LIST
        .into_iter()
        .map(|s| s.parse().unwrap())
        .collect::<Vec<IpAddr>>();
    let reader = maxminddb::Reader::open_file(path).unwrap();

    let guard = pprof::ProfilerGuard::new(100).unwrap();

    for _ in 0..100000 {
        for ip in ips.iter() {
            let _ = reader.lookup::<maxminddb::City>(*ip);
        }
    }

    match guard.report().build() {
        Ok(report) => {
            let file = File::create("flamegraph.svg").unwrap();
            report.flamegraph(file).unwrap();
        }
        Err(err) => panic!("{}", err)
    };
}